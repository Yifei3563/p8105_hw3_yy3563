---
title: "p8105_hw3_yy3563"
author: "Yifei Yu"
date: "2024-10-12"
output: github_document
---

```{r}
library(dplyr)
library(tidyverse) 
library(patchwork)
library(haven)
library(ggplot2)
```


## Problem 1

```{r}
library(p8105.datasets)
data("ny_noaa")
```

```{r}
head(ny_noaa)
dim(ny_noaa)
str(ny_noaa)
summary(ny_noaa)
```

The `ny_noaa` dataset includes variables such as `id`, `date`, `prcp`, `snow`, `snwd`, `tmax`, and `tmin`. There are 2595176 observations in the dataset. There are `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns. `id`, `tmax`, and `tmin` are characters. `prcp`, `snow`, and `snwd` are integers.

```{r}
sapply(ny_noaa, function(x) sum(is.na(x)))
sum(is.na(ny_noaa))
```

We can see that `id` and `date` have no missing value, while `prcp` has 145838 missing value, `snow` has 381221, `snwd` has 591786, `tmax` has 1134358, and `tmin` has 1134420 missing value. The overall number of missing value is 3387623.
Both `tmax` and `tmin` have a lot of missing value, which may lead to issues when analyzing data.

#### Clean the data

```{r}
ny_noaa_clean = ny_noaa |> 
  mutate(
    year = year(date),
    month = month(date),
    day = day(date)
  ) |> 
  mutate(
    tmax = as.numeric(as.character(tmax)),
    tmin = as.numeric(as.character(tmin))
  ) |> 
  mutate(
    tmax = tmax / 10,
    tmin = tmin / 10
  ) |> 
  mutate(
    prcp = prcp / 10,
    snow = snow /10,
    snwd = snwd /10
  )
```

#### Find the most commonly observed values for snowfall.

```{r}
common_snowfall = ny_noaa_clean |> 
  group_by(snow) |> 
  summarize(count = n()) |> 
  arrange(desc(count))

head(common_snowfall)
```

The most commonly observed values for snowfall is 0. This because snowfall occurs only during winter and only happen in certain regions. This would result in a high frequency of zero values in the dataset.

#### Create the Two-Panel Plot

```{r}
ny_noaa_clean |> 
  filter(month %in% c(1, 7)) |> 
  group_by(id, year, month) |> 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE)) |> 
  ggplot(aes(x = year, y = mean_tmax, color = id)) +
  geom_point(show.legend = F) +
  facet_grid(. ~ month)
```

The average tmax in January show a much larger spread compared to July. Both of the months show a consistent pattern. There are a few outliers below -10Â°C in January. These could be caused by extremely cold days. There is one outlier in July where the station was recorded below 15. 

#### tmax vs tmin

```{r}
ny_noaa_clean |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex() 
```


#### Plot showing the distribution of snowfall values greater than 0 and less than 100 separately by year

```{r}
ny_noaa_clean |> 
  filter(snow > 0 & snow < 100) |> 
  mutate(year = factor(year)) |> 
  ggplot(aes(x = year, y = snow)) +
  geom_boxplot()
```


